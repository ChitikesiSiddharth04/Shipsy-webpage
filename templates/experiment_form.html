{% extends "base.html" %}

{% block title %}{{ 'Edit' if experiment.id else 'New' }} Experiment - ML Experiments Tracker{% endblock %}

{% block content %}
<div class="modern-card">
    <div class="card-header">
        <div class="d-flex align-items-center justify-content-between">
            <div>
                <h1 class="card-title mb-2">
                    <i class="fas fa-{{ 'edit' if experiment.id else 'plus-circle' }}"></i>
                    {{ 'Edit' if experiment.id else 'Create New' }} ML Experiment
                </h1>
                <p class="mb-0 page-header-subtitle">
                    {{ 'Update your experiment details' if experiment.id else 'Add a new machine learning experiment to track' }}
                </p>
            </div>
        </div>
    </div>
</div>

<div class="form-modern">
    <form method="POST" id="experimentForm">
        <div class="row">
            <!-- Title -->
            <div class="col-12">
                <div class="form-group">
                    <label for="title" class="form-label">
                        <i class="fas fa-tag"></i> Experiment Title *
                    </label>
                    <input type="text" class="form-control" id="title" name="title" 
                           value="{{ experiment.title or '' }}" required 
                           placeholder="e.g., ResNet-50 Image Classification on CIFAR-100">
                </div>
            </div>

            <!-- Description -->
            <div class="col-12">
                <div class="form-group">
                    <label for="description" class="form-label">
                        <i class="fas fa-align-left"></i> Description *
                    </label>
                    <textarea class="form-control" id="description" name="description" 
                              rows="4" required placeholder="Describe your experiment methodology, dataset, objectives, and approach...">{{ experiment.description or '' }}</textarea>
                </div>
            </div>

            <!-- Model Type and Status -->
            <div class="col-md-6">
                <div class="form-group">
                    <label for="model_type" class="form-label">
                        <i class="fas fa-brain"></i> Model Type *
                    </label>
                    <select class="form-control" id="model_type" name="model_type" required>
                        <option value="">Select Model Type</option>
                        {% for model_type in model_types %}
                        <option value="{{ model_type }}" 
                                {% if experiment.model_type == model_type %}selected{% endif %}>
                            {{ model_type }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="col-md-6">
                <div class="form-group">
                    <label for="status" class="form-label">
                        <i class="fas fa-tasks"></i> Status *
                    </label>
                    <select class="form-control" id="status" name="status" required>
                        <option value="">Select Status</option>
                        {% for status in statuses %}
                        <option value="{{ status }}" 
                                {% if experiment.status == status %}selected{% endif %}>
                            {{ status }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- Accuracy -->
            <div class="col-md-6">
                <div class="form-group">
                    <label for="accuracy" class="form-label">
                        <i class="fas fa-percentage"></i> Accuracy (%)
                    </label>
                    <input type="number" class="form-control" id="accuracy" name="accuracy" 
                           value="{{ experiment.accuracy or '' }}" min="0" max="100" step="0.1"
                           placeholder="e.g., 87.3">
                </div>
            </div>

            <!-- Is Public -->
            <div class="col-md-6">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-globe"></i> Visibility
                    </label>
                    <div class="form-check form-switch" style="margin-top: 0.5rem;">
                        <input class="form-check-input" type="checkbox" id="is_public" name="is_public" 
                               value="1" {% if experiment.is_public %}checked{% endif %}>
                        <label class="form-check-label" for="is_public" style="font-weight: 500;">
                            Make this experiment public
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="d-flex flex-column flex-md-row justify-content-between gap-3 mt-4">
            <a href="{{ url_for('dashboard') }}" class="btn-modern btn-secondary">
                <i class="fas fa-arrow-left"></i>
                <span>Back to Dashboard</span>
            </a>
            <div class="d-flex gap-2">
                {% if experiment.id %}
                <a href="{{ url_for('view_experiment', experiment_id=experiment.id) }}" 
                   class="btn-modern btn-outline">
                    <i class="fas fa-eye"></i>
                    <span>View</span>
                </a>
                {% endif %}
                <button type="submit" class="btn-modern btn-primary">
                    <i class="fas fa-save"></i>
                    <span>{{ 'Update' if experiment.id else 'Create' }} Experiment</span>
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('experimentForm');
    
    if (form) {
        // Client-side validation
        form.addEventListener('submit', function(e) {
            const title = document.getElementById('title').value.trim();
            const description = document.getElementById('description').value.trim();
            const modelType = document.getElementById('model_type').value;
            const status = document.getElementById('status').value;
            const accuracy = document.getElementById('accuracy').value;
            
            let isValid = true;
            let errorMessage = '';
            
            // Validate required fields
            if (!title) {
                errorMessage += 'Title is required.\n';
                isValid = false;
            }
            
            if (!description) {
                errorMessage += 'Description is required.\n';
                isValid = false;
            }
            
            if (!modelType) {
                errorMessage += 'Model type is required.\n';
                isValid = false;
            }
            
            if (!status) {
                errorMessage += 'Status is required.\n';
                isValid = false;
            }
            
            // Validate accuracy if provided
            if (accuracy) {
                const accValue = parseFloat(accuracy);
                if (isNaN(accValue) || accValue < 0 || accValue > 100) {
                    errorMessage += 'Accuracy must be between 0 and 100.\n';
                    isValid = false;
                }
            }
            
            if (!isValid) {
                e.preventDefault();
                alert('Please fix the following errors:\n' + errorMessage);
            }
        });
    }
});
</script>
{% endblock %} 